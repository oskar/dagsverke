<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Basic time tracking tool">
    <meta name="author" content="Oskar Hermansson">
    <link rel="shortcut icon" href="favicon.ico">

    <title>Dagsverke</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this page -->
    <link href="dagsverke.css" rel="stylesheet">
  </head>

  <body>
    <div class="container">
      <div class="page-header">
        <h1>Dagsverke </h1>
        <p class="lead">Basic time tracking tool <span class="glyphicon glyphicon-time"></span></p>
        <p>Calculate the length of your work day by entering the time when you came to work, how long break you had and when you left work.</p>
      </div>
      
      <div class="row">
        <div class="col-md-4">
          <div class="form-group">
            <label for="inputTimeOfArrival">Time of arrival [HH:mm]</label>
            <input type="text" class="form-control" id="inputTimeOfArrival" placeholder="HH:mm"/>
            <p class="help-block">Enter the time when you came to work.</p>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="form-group">
            <label for="inputBreak">Break [minutes]</label>
            <input type="text" class="form-control" id="inputBreak" placeholder="Minutes" value="60"/>
            <p class="help-block">Enter time of break (lunch or other) in minutes.</p>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="form-group">
            <label for="inputTimeOfLeaving">Time of leaving [HH:mm]</label>
            <input type="text" class="form-control" id="inputTimeOfLeaving" placeholder="HH:mm"/>
            <p class="help-block">Enter the time when you left work.</p>
          </div>
        </div>
      </div>
      
      <div>
        <h1><span class="glyphicon glyphicon-chevron-right"></span> <span id="calculatedWorkTime"></span></h1>
      </div>
    </div> <!-- /container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    
    <!-- Bootstrap core JavaScript goes here if needed -->
    
    
    <script>
function parse() {
  var start = $('#inputTimeOfArrival').val();
  var end = $('#inputTimeOfLeaving').val();
  var lunch = $('#inputBreak').val();
  
  var startInMinutes = toMinutes(start);
  var endInMinutes = toMinutes(end);
  
  var workInMinutes = endInMinutes - startInMinutes - lunch;
  
  if(isNaN(workInMinutes))
    return;
  
  var workTime = Math.round(workInMinutes * 100 / 60) / 100;
  var workHours = Math.floor(workInMinutes / 60);
  var workMinutes = workInMinutes % 60;
  
  $('#calculatedWorkTime').text(workHours + 'h ' + workMinutes + 'min (' + workTime + ')');
}

function toMinutes(str) {

  if(str.length == 5) {
    var arr = str.split(':');
    var hours = arr[0];
    var minutes = arr[1];
  }
  else if(str.length == 4) {
    var hours = str.substring(0, 2);
    var minutes = str.substring(2, 4);
  }
  
  return parseInt(hours, 10) * 60 + parseInt(minutes, 10);
}

$('#inputTimeOfArrival').change(parse);
$('#inputTimeOfLeaving').change(parse);
$('#inputBreak').change(parse);
</script>
  </body>
</html>
